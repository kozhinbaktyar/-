<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ù¾Û•ÛŒØ§Ù…Ù†ÛŽØ±ÛŒ</title>

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="theme-color" content="#764ba2">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
font-family:'Segoe UI',Tahoma;
background:#f0f2f5;
padding-top:56px
}
.navbar{
position:fixed;top:0;left:0;right:0;
height:56px;background:#fff;
display:flex;justify-content:space-between;align-items:center;
padding:0 16px;box-shadow:0 2px 4px rgba(0,0,0,.1);
z-index:1000
}
.logo{
width:40px;height:40px;border-radius:50%;
background:linear-gradient(135deg,#667eea,#764ba2);
display:flex;align-items:center;justify-content:center;
color:#fff;font-size:20px
}
.app-title{font-weight:600}
.icon-btn{
width:40px;height:40px;border-radius:50%;
border:none;background:#e4e6eb;
cursor:pointer;font-size:18px
}
.container{max-width:500px;margin:20px auto;padding:0 16px}
.login-box,.chat-container{
background:#fff;border-radius:20px;
box-shadow:0 2px 8px rgba(0,0,0,.1)
}
.login-box{padding:30px;text-align:center}
.input-group{text-align:right;margin-bottom:15px}
input{
width:100%;padding:12px;border-radius:10px;
border:2px solid #e0e0e0;font-size:16px
}
.btn-login{
width:100%;padding:14px;
background:linear-gradient(135deg,#667eea,#764ba2);
color:#fff;border:none;border-radius:10px;font-size:16px
}
.chat-container{display:none;height:calc(100vh - 100px);flex-direction:column}
.chat-header{
padding:20px;color:#fff;
background:linear-gradient(135deg,#667eea,#764ba2);
text-align:center
}
.messages-area{
flex:1;overflow-y:auto;padding:20px;background:#f5f5f5
}
.message{
background:#fff;padding:15px;border-radius:15px;
margin-bottom:10px
}
.hidden{display:none}
.show{display:flex}
</style>
</head>

<body>

<nav class="navbar">
<div style="display:flex;gap:10px;align-items:center">
<div class="logo">ðŸ’¬</div>
<div class="app-title">Ø³ÛŒØ³ØªÛ•Ù…ÛŒ Ù¾Û•ÛŒØ§Ù…Ù†ÛŽØ±ÛŒ</div>
</div>
<button class="icon-btn" onclick="refreshMessages()">ðŸ”„</button>
</nav>

<div class="container">

<div class="login-box" id="loginBox">
<h2>Ø¨Û•Ø®ÛŽØ±Ø¨ÛŽÛŒØª</h2>
<p>Ú©Û†Ø¯ÛŒ ØªØ§ÛŒØ¨Û•ØªÛŒ Ø®Û†Øª Ø¨Ù†ÙˆÙˆØ³Û•</p>
<div class="input-group">
<input id="userIdInput" placeholder="ID">
</div>
<button class="btn-login" onclick="login()">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</button>
<p id="error" style="color:red;display:none;margin-top:10px">
Ú©Û†Ø¯ÛŒ Ù‡Û•ÚµÛ•
</p>
</div>

<div class="chat-container" id="chatContainer">
<div class="chat-header">
<h3>Ù¾Û•ÛŒØ§Ù…Û•Ú©Ø§Ù†Øª</h3>
<div id="userInfo"></div>
</div>
<div class="messages-area" id="messagesArea"></div>
</div>

</div>

<audio id="notificationSound">
<source src="https://actions.google.com/sounds/v1/notifications/ping.ogg">
</audio>

<script>
const SCRIPT_URL="https://script.google.com/macros/s/AKfycbysGtWgBc_df30UpZLLoqBkYCC4eTqjgR5YrySSwkC-v6HmhG6uE-0YiFuyax1x84af/exec";

let currentUserId=null;
let lastMessageCount=0;

window.onload=()=>{
const savedId=localStorage.getItem("userId");
if(savedId){
currentUserId=savedId;
autoLogin();
}
};

function login(){
const id=document.getElementById("userIdInput").value.trim();
if(!id)return;
localStorage.setItem("userId",id);
currentUserId=id;
loadMessages();
}

function autoLogin(){
document.getElementById("loginBox").classList.add("hidden");
document.getElementById("chatContainer").classList.add("show");
loadMessages();
}

async function loadMessages(){
try{
const res=await fetch(SCRIPT_URL);
const data=await res.json();
const msgs=data.filter(m=>m.id===currentUserId);

if(msgs.length===0){
document.getElementById("error").style.display="block";
return;
}

document.getElementById("loginBox").classList.add("hidden");
document.getElementById("chatContainer").classList.add("show");
document.getElementById("userInfo").innerText="ID: "+currentUserId;

if(lastMessageCount && msgs.length>lastMessageCount){
document.getElementById("notificationSound").play().catch(()=>{});
}
lastMessageCount=msgs.length;

displayMessages(msgs);

}catch(e){console.log(e)}
}

function displayMessages(msgs){
const box=document.getElementById("messagesArea");
box.innerHTML="";
msgs.forEach(m=>{
const d=document.createElement("div");
d.className="message";
d.innerText=m.message;
box.appendChild(d);
});
box.scrollTop=box.scrollHeight;
}

function refreshMessages(){
if(currentUserId)loadMessages();
}

setInterval(()=>{
if(currentUserId)refreshMessages();
},30000);
</script>

</body>
</html>
